<!doctype html>

<html>
	<head>
		<meta charset="utf-8">


		<!-- bootstrap includes -->

		<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

		<!-- Latest compiled and minified CSS -->
		<link rel="stylesheet" href="bootstrap/dist/css/bootstrap.min.css">

		<!-- Optional theme -->
		<link rel="stylesheet" href="bootstrap/dist/css/bootstrap-theme.min.css">

		<!-- Latest compiled and minified JavaScript -->
		<script src="bootstrap/dist/js/bootstrap.min.js"></script>


		<!-- angular ui grid includes -->
		<link rel="styleSheet" href="angular-ui-grid/ui-grid.min.css"/>
		<script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.3.16/angular.min.js"></script>
		<script src="angular-ui-grid/ui-grid.min.js"></script>

        <link rel="stylesheet" href="custom.css">

		<title>View Issues</title>
		<script>

			function compare(a,b) {
			  if (parseInt(a.severity) < parseInt(b.severity))
			    return 1;
			  else if (a.severity > b.severity)
			    return -1;
			  else 
			    return 0;
			}

			var app = angular.module('incidentApp', ['ui.grid', 'ui.grid.selection', 'ui.grid.resizeColumns', 'ui.grid.moveColumns']);


			app.controller('incidentCtrl', function($scope, $http) {
				// commented out from first object: things I don't think I'll need but might
				var fromServer = [
        			{
        			 //"submitterid": 1,
        			 "submitterfn": "Erica",
        			 "submitterln": "Schwartz",
        			 //"incidentid": 100,
        			 "severity": 10,
        			 "description": "THERE ARE MOTHER FUCKING SNAKES ON THIS MOTHER FUCKING PLANE",
        			 "departments": [1,4],
        			 "incident types": [6,2],
        			 "location": "Logan Airport", // later this will be more than one field for coords, google location id, etc.
        			 //"timestamp": "Tue Feb 09 2016 16:04:19 GMT-0500 (EST)" WILL DISPLAY
        			 "status": 0,
        			 "permission": 2
        			},
        			{
        			 //"submitterid": 2,
        			 "submitterfn": "Norman",
        			 "submitterln": "Young",
        			 //"incidentid": 200,
        			 "severity": 3,  // why is this a varchar in our data model?
        			 "description": "My nose itches.",
        			 "departments": [1,4],
        			 "incident types": [6,2],
        			 "location": "175 College Avenue", // will this be coordinates? In what format?
        			 //"timestamp": "Tue Feb 09 2016 16:04:19 GMT-0500 (EST)"
        			 "status": 1,
        			 "permission": 2
        			}
        		];

        		// adding some dummy items to show how the table handles large amounts of data
        		for (var j = 0; j < 40; j++) {
            		fromServer.push({
        			 	//"submitterid": 2,
        			 	"submitterfn": "Norman",
        			 	"submitterln": "Young",
        			 	//"incidentid": 200,
        			 	"severity": j/4,  // why is this a varchar in our data model?
        			 	"description": "My nose itches.",
        			 	"departments": [1,4],
        			 	"incident types": [6,2],
        			 	"location": "175 College Avenue", // will this be coordinates? In what format?
        			 	//"timestamp": "Tue Feb 09 2016 16:04:19 GMT-0500 (EST)"
        			 	"status": 1,
        			 	"permission": 2
        			});
            	}

				fromServer.sort(compare);

            	incidentData = [];
         
            	for (var i = 0; i < fromServer.length; i++) {
            		var status;
            		if (fromServer[i]['status'] === 0) {
            			status = "Unresolved";
            		} else if (fromServer[i]['status'] === 1) {
            			status = "In Progress";
            		} else {
            			status = "Resolved";
            		}
            		var edit;
            		if (fromServer[i]['permission'] === 0) {
            			edit = "Neither";
            			continue;
            		} else if (fromServer[i]['permission'] === 1) {
            			edit = "View Only";
            		} else {
            			edit = "View and Edit";
            		}
            		incidentData.push({
            			"submitter": fromServer[i]['submitterln'] + ", " + fromServer[i]['submitterfn'],
            			"severity": parseInt(fromServer[i]['severity']),
            			"description": fromServer[i]['description'],
            			"departments": "TBD",
            			"location": fromServer[i]['location'],
            			"edit": edit,
            			"status": status
            		});
            	}

            	 $scope.gridOptions = { 
				  	enableRowSelection: true,
				  	enableRowHeaderSelection: false,
				  	rowHeight: 35
				 };
 
				  $scope.gridOptions.columnDefs = [
				    { name: 'submitter', displayName:"Submitted By" },
				    { name: 'severity', displayName:"Severity",
				    	cellClass: function(grid, row, col, rowRenderIndex, colRenderIndex) {
				    		var severity = grid.getCellValue(row,col);
				          	if (severity > 8) {
				            	return 'red';
				          	} else if (severity > 6) {
				          		return 'orange';
				          	}
				        }
					},
				    { name: 'description', displayName: "Description"},
				    { name: 'departments', displayName: "Departments" },
				    { name: 'location', displayName: "Location" },
				    { name: 'edit', displayName: "View / Edit" },
				    { name: 'status', displayName: "Status" },
				  ];
				 
				  $scope.gridOptions.multiSelect = false;
				  $scope.gridOptions.modifierKeysToMultiSelect = false;
				  $scope.gridOptions.noUnselect = false;

				  $scope.gridOptions.data = incidentData;

			});
			

		</script>

	</head>
	
	<body>

<nav class="row navbar-default">    
    <!-- Collect the nav links, forms, and other content for toggling -->
      	<a class="navitem col-md-4">Home</a>
      	<a class="navitem col-md-4">Report an Incident</a>
        <a class="current col-md-4">View Incident Reports</a>
</nav>

			<div ng-controller="incidentCtrl" ng-app="incidentApp">
  				<div ui-grid="gridOptions" ui-grid-selection ui-grid-resize-columns ui-grid-move-columns class="myGrid"></div>
			</div>
	</body>
</html>